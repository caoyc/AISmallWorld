# 游戏世界指令系统

## 概述

游戏世界指令系统是 BoinicWorld 的核心功能，提供了完整的四层世界结构（World → Region → Place → Room）和丰富的指令操作。系统支持三种输入方式：直接对话、强指令模式（!）和智能指令模式（$）。

## 三种输入方式

### 1. 直接输入（对话模式）

**说明**：直接输入文字，与AI角色进行正常对话。

**特点**：
- ✅ 支持多轮对话
- ✅ 自动记忆对话内容（仿生记忆系统）
- ✅ 适合日常交流和咨询

**示例**：
```
你好，今天天气怎么样？
```

---

### 2. 强指令模式（! 开头）

**说明**：使用 `!` 开头，直接执行游戏指令，速度最快。

**语法**：`!指令名称 参数`

**特点**：
- ✅ 执行速度快
- ✅ 直接调用游戏指令
- ✅ 适合熟悉指令的用户

**支持的指令前缀**：
- `!`（半角感叹号）
- `！`（全角感叹号）

**示例**：
```
!look
!create name=温馨家园 desc="一个温馨舒适的居住区域"
!visit name=温馨家园
!room create name=客厅 desc="住宅区的主要活动空间"
```

---

### 3. 智能指令模式（$ 开头）

**说明**：使用 `$` 开头，系统会智能识别自然语言表述的意图，自动转换为对应的游戏指令。

**语法**：`$自然语言描述`

**特点**：
- ✅ 使用自然语言，更直观
- ✅ 自动识别意图并转换指令
- ⚠️ 调用多Agent处理，速度较慢
- ⚠️ 需要等待AI识别和转换过程

**支持的指令前缀**：
- `$`（半角美元符号）
- `＄`（全角美元符号）
- `￥`（人民币符号）

**示例**：
```
$查看当前位置
$创建一个叫温馨家园的区域
$在当前场所建一个名为客厅的房间
$在客厅创建一个名为沙发的物品
$进入住宅区场所
```

---

## 层级结构

游戏世界采用四层结构，每层有不同的功能和可用的指令：

```
World层（荒野层）
  └── Region层（区域层）
       └── Place层（场所层）
            └── Room层（房间层）
```

### World层（荒野层）

**概念**：最外层，代表整个游戏世界的坐标系统。

**功能**：
- 创建和管理区域（Region）
- 在世界坐标中移动
- 管理角色（char）

**支持的指令**：
- `look` - 查看当前坐标和区域信息
- `create` - 创建区域
- `delete` - 删除区域
- `visit` - 进入已开发的区域
- `goto` - 移动到指定坐标
- `north/south/east/west` - 方向移动
- `northeast/northwest/southeast/southwest` - 斜向移动
- `up/down` - 垂直移动
- `char` - 角色操作（create/update/delete/look/list/activate/deactivate）

**示例**：
```
!look                                    # 查看当前位置
!create name=温馨家园 desc="一个温馨舒适的居住区域"  # 创建区域
!visit name=温馨家园                     # 进入区域
!goto 100,200                           # 前往坐标
!north                                  # 向北走
```

---

### Region层（区域层）

**概念**：区域层，代表一个具体的区域，包含多个场所。

**功能**：
- 创建和管理场所（Place）
- 更新区域描述和图像
- 在区域内移动
- 管理角色（char）

**支持的指令**：
- `look` - 查看区域信息
- `create` - 创建场所
- `update` - 更新区域属性（desc/image）
- `delete` - 删除场所
- `visit` - 进入场所
- `return` - 返回世界层
- `list` - 列出所有场所
- `north/south/east/west` - 方向移动
- `northeast/northwest/southeast/southwest` - 斜向移动
- `up/down` - 垂直移动
- `char` - 角色操作

**示例**：
```
!create name=住宅区 desc="温馨家园的主要居住区域"  # 创建场所
!update desc="温馨家园是一个温馨舒适的居住区域"    # 更新区域描述
!look                                    # 查看当前区域
!list                                    # 列出所有场所
!return                                  # 返回荒野层
!visit name=住宅区                       # 进入场所
!north                                   # 向北走
```

---

### Place层（场所层）

**概念**：场所层，代表区域内的一个具体场所，包含多个房间。

**功能**：
- 创建和管理房间（Room）
- 创建物品、出口、NPC等对象
- 更新场所描述和图像
- 管理角色（char）

**支持的指令**：
- `look` - 查看场所信息
- `create` - 创建房间
- `room` - 房间操作（create/update/delete/look/list）
- `item` - 物品操作（create/update/delete/look/list/get/drop/check/wear/remove）
- `npc` - NPC操作（create/update/delete/look/list）
- `exit` - 出口操作（create/update/delete/look/list）
- `animal` - 动物操作（create/update/delete/look/list）
- `plant` - 植物操作（create/update/delete/look/list）
- `monster` - 怪物操作（create/update/delete/look/list）
- `update` - 更新场所属性（desc/image）
- `delete` - 删除房间
- `visit` - 进入房间
- `return` - 返回区域层
- `list` - 列出所有房间
- `char` - 角色操作

**示例**：
```
!room create name=客厅 desc="住宅区的主要活动空间"  # 创建房间
!room list                                # 列出所有房间
!room look name=客厅                      # 查看房间
!item create name=沙发 desc="客厅的主要家具"  # 创建物品
!item list                                # 列出所有物品
!exit create name=卧室门 to=卧室 desc="从客厅通往卧室的门"  # 创建出口
!exit list                                # 列出所有出口
!npc create name=店小二 desc="负责接待的店小二"  # 创建NPC
!npc list                                 # 列出所有NPC
!return                                   # 返回区域层
```

---

### Room层（房间层）

**概念**：房间层，代表场所内的一个具体房间，是最细粒度的空间单位。

**功能**：
- 创建和管理物品（item）
- 创建和管理出口（exit）
- 创建和管理NPC、怪物、动物、植物
- 物品交互（获取、丢弃、穿戴等）
- 通过出口移动到其他房间
- 管理角色（char）

**支持的指令**：
- `look` - 查看房间信息
- `return` - 返回场所层
- `go` - 通过出口移动
- `north/south/east/west` - 方向移动（通过出口）
- `northeast/northwest/southeast/southwest` - 斜向移动
- `up/down` - 垂直移动
- `update` - 更新房间属性（desc/image）
- `item` - 物品操作（create/update/delete/look/list/get/drop/check/wear/remove）
- `exit` - 出口操作（create/update/delete/look/list）
- `npc` - NPC操作（create/update/delete/look/list）
- `animal` - 动物操作（create/update/delete/look/list）
- `plant` - 植物操作（create/update/delete/look/list）
- `monster` - 怪物操作（create/update/delete/look/list）
- `char` - 角色操作

**示例**：
```
!look                                    # 查看当前房间
!update desc="更新后的房间描述"            # 更新房间描述
!return                                  # 返回场所层
!item create name=沙发 desc="客厅的主要家具"  # 创建物品
!item get name=沙发                      # 拿起物品
!item drop name=沙发                    # 放下物品
!item list                               # 列出所有物品
!exit create name=卧室门 to=卧室 desc="从客厅通往卧室的门"  # 创建出口
!go name=卧室门                          # 通过出口移动
!exit list                               # 列出所有出口
!npc create name=店小二 desc="负责接待的店小二"  # 创建NPC
!npc look name=店小二                    # 查看NPC
!npc list                                # 列出所有NPC
```

---

## 层级切换

### 进入下一层

使用 `visit` 指令进入下一层：
- World层 → Region层：`!visit name=区域名`
- Region层 → Place层：`!visit name=场所名`
- Place层 → Room层：`!visit name=房间名`

### 返回上一层

使用 `return` 指令返回上一层：
- Room层 → Place层：`!return`
- Place层 → Region层：`!return`
- Region层 → World层：`!return`

---

## 常用指令详解

### look - 查看信息

**功能**：查看当前位置的详细信息。

**可用层级**：World、Region、Place、Room

**语法**：
```
!look
```

**说明**：
- 在世界层：显示当前坐标、区域信息
- 在区域层：显示区域名称、描述、配图、场所列表
- 在场所层：显示场所名称、描述、配图、房间列表
- 在房间层：显示房间名称、描述、配图、出口列表、物品列表、NPC列表等

---

### create - 创建对象

**功能**：创建下一层级对象。

**可用层级**：World、Region、Place

**语法**：
```
!create name=<名称> [desc=<描述>] [image=<图像URL/描述>] [generate_image=<true/false>]
```

**参数说明**：
- `name`（必需）：对象名称
- `desc`（可选）：对象描述
- `image`（可选）：图像URL或配图描述文本
- `generate_image`（可选）：是否生成图像，默认 `false`

**层级行为**：
- **World层**：创建区域（Region）
- **Region层**：创建场所（Place）
- **Place层**：创建房间（Room）

**示例**：
```
!create name=温馨家园 desc="一个温馨舒适的居住区域"
!create name=海景房 desc="一个面朝大海的房子" image="海边风景" generate_image=true
```

---

### update - 更新对象属性

**功能**：更新当前层级对象的属性。

**可用层级**：Region、Place、Room

**语法**：
```
!update desc=<描述>
!update image=<图像URL/描述>
!update prompt=<提示语> prompt_enable=<true/false>
```

**参数说明**：
- `desc`：更新描述（空值或空字符串表示清除）
- `image`：更新配图（URL直接设置，其他文本仅用于生成配图）
- `prompt`：更新提示语
- `prompt_enable`：启用/禁用提示语

**示例**：
```
!update desc="新的描述内容"
!update image="新的配图描述"
!update prompt="新的提示语" prompt_enable=true
```

---

### delete - 删除对象

**功能**：删除当前层级或指定对象。

**可用层级**：World、Region、Place

**语法**：
```
!delete                    # 删除当前对象（World/Region层）
!delete name=<名称>        # 删除指定对象（Region/Place层）
```

**示例**：
```
!delete                    # 删除当前区域
!delete name=目标名称      # 删除指定场所
```

---

### visit - 进入下一层

**功能**：进入下一层级。

**可用层级**：World、Region、Place

**语法**：
```
!visit name=<名称>
```

**示例**：
```
!visit name=温馨家园      # 进入区域
!visit name=住宅区        # 进入场所
!visit name=客厅          # 进入房间
```

---

### return - 返回上一层

**功能**：返回上一层。

**可用层级**：Region、Place、Room

**语法**：
```
!return
```

**示例**：
```
!return                   # 返回上一层
```

---

### room - 房间操作

**功能**：在场所层或房间层进行房间相关操作。

**可用层级**：Place、Room

**语法**：
```
!room create name=<名称> [desc=<描述>] [image=<图像URL/描述>] [generate_image=<true/false>]
!room update name=<名称> [desc=<描述>]
!room delete name=<名称>
!room look [name=<名称>]
!room list
```

**示例**：
```
!room create name=客厅 desc="住宅区的主要活动空间"
!room update name=客厅 desc="新的描述"
!room delete name=客厅
!room look name=客厅
!room list
```

---

### item - 物品操作

**功能**：创建、管理物品，进行物品交互。

**可用层级**：Place、Room

**语法**：
```
!item create name=<名称> [desc=<描述>] [count=<数量>] [from=<房间名>]
!item update name=<名称> [desc=<描述>]
!item delete name=<名称> [from=<房间名>]
!item look name=<名称> [from=<房间名>]
!item list [from=<房间名>]
!item get name=<名称> [count=<数量>] [from=<房间名>]
!item drop name=<名称> [from=<房间名>]
!item check
!item wear name=<物品名> char=<角色名> [from=<房间名>]
!item remove name=<物品名> char=<角色名> [from=<房间名>]
```

**示例**：
```
!item create name=苹果 desc="一个红苹果" count=5
!item get name=苹果 count=2
!item drop name=苹果
!item check
!item wear name=衣服 char=角色名
```

---

### npc - NPC操作

**功能**：创建、管理NPC。

**可用层级**：Place、Room

**语法**：
```
!npc create name=<名称> [desc=<描述>] [from=<房间名>]
!npc update name=<名称> [desc=<描述>]
!npc delete name=<名称> [from=<房间名>]
!npc look name=<名称> [from=<房间名>]
!npc list [from=<房间名>]
```

**示例**：
```
!npc create name=店老板 desc="一个友好的店老板"
!npc look name=店老板
!npc list
```

---

### exit - 出口操作

**功能**：创建、管理出口，连接房间。

**可用层级**：Place、Room

**语法**：
```
!exit create name=<名称> to=<目标> [desc=<描述>] [both=<true/false>] [from=<房间名>]
!exit update name=<名称> [desc=<描述>] [from=<房间名>]
!exit delete name=<名称> [both=<true/false>] [from=<房间名>]
!exit look <名称> [from=<房间名>]
!exit list [from=<房间名>]
```

**参数说明**：
- `both=true`：创建双向出口

**示例**：
```
!exit create name=north to=客厅 desc="通往客厅的门"
!exit create name=north to=客厅 both=true
!exit look north
!exit list
```

---

### go - 通过出口移动

**功能**：通过出口移动到其他房间。

**可用层级**：Room

**语法**：
```
!go <方向/出口名/出口编号>
```

**示例**：
```
!go north
!go 1
!go #148
```

---

### char - 角色操作

**功能**：创建、管理角色/伙伴。

**可用层级**：World、Region、Place、Room

**语法**：
```
!char create name=<名称>
!char update name=<名称> [desc=<描述>]
!char delete name=<名称>
!char look name=<名称>
!char list
!char activate name=<名称>
!char deactivate name=<名称>
```

**示例**：
```
!char create name=晚晴
!char activate name=晚晴
!char look name=晚晴
!char list
```

---

## 指令参数格式

强指令模式需要严格按照指令语法格式，参数使用 `name=值` 的形式：

**正确示例**：
```
!create name=温馨家园 desc="一个温馨舒适的居住区域"
!visit name=温馨家园
!room create name=客厅 desc="住宅区的主要活动空间"
!item create name=沙发 desc="客厅的主要家具"
```

**注意事项**：
- 参数名和值之间使用 `=` 连接
- 如果值包含空格，需要用引号包裹（如 `desc="描述内容"`）
- 多个参数之间用空格分隔

---

## 使用建议

### 何时使用直接输入
- 与AI角色进行正常对话
- 不需要执行游戏操作

### 何时使用强指令（!）
- 熟悉游戏指令语法
- 需要快速执行操作
- 批量操作时效率更高

### 何时使用智能指令（$）
- 不熟悉游戏指令语法
- 想用自然语言描述操作
- 不介意等待处理时间

---

## 帮助系统

### 查看可用指令

使用 `help` 或 `swhelp` 指令查看当前层级可用的智能指令：

```
help
```

### 查看指令详细帮助

使用 `help <指令名>` 查看具体指令的详细帮助：

```
help create
help item
help npc
```

---

## 快速参考

| 操作 | 强指令（!） | 智能指令（$） |
|------|------------|--------------|
| 查看位置 | `!look` | `$查看当前位置` |
| 创建区域 | `!create name=区域名 desc="描述"` | `$创建一个叫区域名的区域` |
| 进入区域 | `!visit name=区域名` | `$进入区域名` |
| 创建场所 | `!create name=场所名 desc="描述"` | `$创建一个叫场所名的场所` |
| 创建房间 | `!room create name=房间名 desc="描述"` | `$创建一个叫房间名的房间` |
| 创建物品 | `!item create name=物品名 desc="描述"` | `$创建一个叫物品名的物品` |
| 创建出口 | `!exit create name=出口名 to=目标 desc="描述"` | `$创建一个叫出口名的出口` |
| 创建NPC | `!npc create name=NPC名 desc="描述"` | `$创建一个叫NPC名的NPC` |
| 返回上一层 | `!return` | `$返回上一层` |
| 通过出口 | `!go name=出口名` | `$通过出口名` |

---

## 注意事项

1. **指令前缀区分大小写**：`!` 和 `$` 必须使用正确的符号
2. **智能指令速度**：使用 `$` 开头的智能指令会调用多Agent处理，响应时间较长
3. **指令格式**：强指令（!）需要严格按照指令语法格式，参数使用 `name=值` 的形式
4. **自然语言**：智能指令（$）支持自然语言描述，系统会自动识别意图
5. **层级限制**：某些指令只能在特定层级使用，使用前请确认当前层级

---

## 开发示例

想要了解如何完整地构建一个游戏世界？可以参考以下示例文档：

- **[晨昏雨林 - 开发示例](示例文档：晨昏雨林.md)**
- **[温馨家园 - 开发示例](示例文档：温馨家园开发示例.md)**
- **[凤凰栖洲 - 开发示例](示例文档：凤凰栖洲开发示例.md)**

这些示例展示了如何从零开始构建完整的游戏场景，包含所有创建、移动、交互指令的实际应用。

