# 编辑面板保存字段完整性检查

## 一、伙伴角色编辑面板字段清单

### 1.1 编辑面板中的字段（UI可见）

| 字段名 | v-model绑定 | 位置 | 说明 |
|--------|------------|------|------|
| user | `roleForm.user` | 第398行 | 用户标识（传给大模型） |
| type | `roleForm.type` | 第405行 | 角色类型（立绘/数字人） |
| name | `roleForm.name` | 第415行 | 角色名称 |
| description | `roleForm.description` | 第423行 | 角色描述 |
| avatar | `roleForm.avatar` | 第511行 | 头像URL |
| scale | `roleForm.scale` | 第526行 | 缩放比例（仅数字人） |
| avatarAppId | `roleForm.avatarAppId` | 第540行 | 数字人App ID（仅数字人） |
| avatarAppSecret | `roleForm.avatarAppSecret` | 第550行 | 数字人App Secret（仅数字人） |
| model | `roleForm.model` | 第629行 | 模型名称 |
| apiKey | `roleForm.apiKey` | 第610行 | API Key（只读显示） |

### 1.2 表单数据中定义的字段（roleForm）

```typescript
const roleForm = ref({
  name: '',                    // ✅ UI中有输入框
  user: '',                    // ✅ UI中有输入框
  type: 'illustration',       // ✅ UI中有选择框
  description: '',            // ✅ UI中有输入框
  avatar: '',                 // ✅ UI中有上传/URL输入
  positionX: 80,              // ⚠️ UI中无输入框（通过拖拽设置）
  positionY: 50,              // ⚠️ UI中无输入框（通过拖拽设置）
  scale: 1.0,                 // ✅ UI中有滑块（仅数字人）
  baseURL: '',                // ⚠️ UI中无输入框（后台自动使用）
  model: '',                  // ✅ UI中有输入框
  apiKey: '',                 // ✅ UI中有显示（只读）
  avatarAppId: '',            // ✅ UI中有输入框（仅数字人）
  avatarAppSecret: ''         // ✅ UI中有输入框（仅数字人）
})
```

### 1.3 保存函数中的字段（handleSaveRole - 更新）

```typescript
await updateRole(
  editingRole.value.id,
  globalApiKey.value,
  {
    name: roleForm.value.name.trim() || undefined,                    // ✅
    user: roleForm.value.user.trim(),                                  // ✅
    type: roleForm.value.type,                                         // ✅
    description: roleForm.value.description.trim() || undefined,      // ✅
    avatar: roleForm.value.avatar && roleForm.value.avatar.trim() ? roleForm.value.avatar.trim() : undefined,  // ✅
    positionX: roleForm.value.positionX,                               // ✅
    positionY: roleForm.value.positionY,                               // ✅
    scale: roleForm.value.scale,                                       // ✅
    baseURL: baseURL,                                                  // ✅（后台逻辑）
    model: roleForm.value.model.trim(),                                // ✅
    apiKey: globalApiKey.value,                                        // ✅（使用登录的API Key）
    avatarAppId: roleForm.value.avatarAppId && roleForm.value.avatarAppId.trim() ? roleForm.value.avatarAppId.trim() : undefined,  // ✅
    avatarAppSecret: roleForm.value.avatarAppSecret && roleForm.value.avatarAppSecret.trim() ? roleForm.value.avatarAppSecret.trim() : undefined  // ✅
  }
)
```

### 1.4 保存函数中的字段（handleSaveRole - 创建）

```typescript
await createRole(
  globalApiKey.value,
  {
    name: roleForm.value.name.trim() || undefined,                    // ✅
    user: roleForm.value.user.trim(),                                  // ✅
    type: roleForm.value.type,                                         // ✅
    description: roleForm.value.description.trim() || undefined,      // ✅
    avatar: roleForm.value.avatar && roleForm.value.avatar.trim() ? roleForm.value.avatar.trim() : undefined,  // ✅
    positionX: roleForm.value.positionX,                               // ✅
    positionY: roleForm.value.positionY,                               // ✅
    scale: roleForm.value.scale,                                       // ✅
    baseURL: baseURL,                                                  // ✅（后台逻辑）
    model: roleForm.value.model.trim(),                                // ✅
    apiKey: globalApiKey.value,                                        // ✅（使用登录的API Key）
    avatarAppId: roleForm.value.avatarAppId && roleForm.value.avatarAppId.trim() ? roleForm.value.avatarAppId.trim() : undefined,  // ✅
    avatarAppSecret: roleForm.value.avatarAppSecret && roleForm.value.avatarAppSecret.trim() ? roleForm.value.avatarAppSecret.trim() : undefined  // ✅
  }
)
```

## 二、用户角色编辑面板字段清单

### 2.1 编辑面板中的字段（UI可见）

| 字段名 | v-model绑定 | 位置 | 说明 |
|--------|------------|------|------|
| type | `userRoleForm.type` | 第851行 | 角色类型（立绘/数字人） |
| name | `userRoleForm.name` | 第861行 | 角色名称 |
| avatar | `userRoleForm.avatar` | 第916行, 1024行 | 头像URL |
| scale | `userRoleForm.scale` | 第926行 | 缩放比例（仅数字人） |
| avatarAppId | `userRoleForm.avatarAppId` | 第939行 | 数字人App ID（仅数字人） |
| avatarAppSecret | `userRoleForm.avatarAppSecret` | 第949行 | 数字人App Secret（仅数字人） |
| baseURL | `userRoleForm.baseURL` | 第809行 | API Base URL |
| model | `userRoleForm.model` | 第818行 | 模型名称 |
| apiKey | `globalApiKey` | 第828行 | API Key（只读显示） |

### 2.2 表单数据中定义的字段（userRoleForm）

```typescript
const userRoleForm = ref({
  name: '',                    // ✅ UI中有输入框
  type: 'illustration',       // ✅ UI中有选择框
  avatar: '',                 // ✅ UI中有上传/URL输入
  positionX: 20,              // ⚠️ UI中无输入框（通过拖拽设置）
  positionY: 50,              // ⚠️ UI中无输入框（通过拖拽设置）
  scale: 1.0,                 // ✅ UI中有滑块（仅数字人）
  baseURL: '',                // ✅ UI中有输入框
  model: '',                  // ✅ UI中有输入框
  avatarAppId: '',            // ✅ UI中有输入框（仅数字人）
  avatarAppSecret: ''         // ✅ UI中有输入框（仅数字人）
})
```

### 2.3 保存函数中的字段（handleSaveUserRole - 更新）

```typescript
await updateUserRole(
  editingUserRole.value.id,
  globalApiKey.value,
  {
    name: userRoleForm.value.name.trim() || undefined,                    // ✅
    type: userRoleForm.value.type,                                        // ✅
    avatar: userRoleForm.value.avatar && userRoleForm.value.avatar.trim() ? userRoleForm.value.avatar.trim() : undefined,  // ✅
    positionX: userRoleForm.value.positionX,                              // ✅
    positionY: userRoleForm.value.positionY,                              // ✅
    scale: userRoleForm.value.scale,                                      // ✅
    baseURL: userRoleForm.value.baseURL.trim() || undefined,              // ✅
    model: userRoleForm.value.model.trim() || undefined,                  // ✅
    avatarAppId: userRoleForm.value.avatarAppId && userRoleForm.value.avatarAppId.trim() ? userRoleForm.value.avatarAppId.trim() : undefined,  // ✅
    avatarAppSecret: userRoleForm.value.avatarAppSecret && userRoleForm.value.avatarAppSecret.trim() ? userRoleForm.value.avatarAppSecret.trim() : undefined  // ✅
  }
)
```

### 2.4 保存函数中的字段（handleSaveUserRole - 创建）

```typescript
await createUserRole(
  globalApiKey.value,
  {
    name: userRoleForm.value.name.trim() || undefined,                    // ✅
    type: userRoleForm.value.type,                                        // ✅
    avatar: userRoleForm.value.avatar && userRoleForm.value.avatar.trim() ? userRoleForm.value.avatar.trim() : undefined,  // ✅
    positionX: userRoleForm.value.positionX,                              // ✅
    positionY: userRoleForm.value.positionY,                              // ✅
    scale: userRoleForm.value.scale,                                      // ✅
    baseURL: userRoleForm.value.baseURL.trim() || undefined,              // ✅
    model: userRoleForm.value.model.trim() || undefined,                  // ✅
    avatarAppId: userRoleForm.value.avatarAppId && userRoleForm.value.avatarAppId.trim() ? userRoleForm.value.avatarAppId.trim() : undefined,  // ✅
    avatarAppSecret: userRoleForm.value.avatarAppSecret && userRoleForm.value.avatarAppSecret.trim() ? userRoleForm.value.avatarAppSecret.trim() : undefined  // ✅
  }
)
```

## 三、检查结果

### 3.1 伙伴角色（Role）

**表单字段 vs 保存字段对比：**

| 字段 | 表单中有 | 保存中有 | 状态 |
|------|---------|---------|------|
| name | ✅ | ✅ | ✅ 完整 |
| user | ✅ | ✅ | ✅ 完整 |
| type | ✅ | ✅ | ✅ 完整 |
| description | ✅ | ✅ | ✅ 完整 |
| avatar | ✅ | ✅ | ✅ 完整 |
| positionX | ⚠️（无UI，通过拖拽） | ✅ | ✅ 完整（拖拽时保存） |
| positionY | ⚠️（无UI，通过拖拽） | ✅ | ✅ 完整（拖拽时保存） |
| scale | ✅（仅数字人） | ✅ | ✅ 完整 |
| baseURL | ⚠️（无UI，后台逻辑） | ✅ | ✅ 完整（后台自动处理） |
| model | ✅ | ✅ | ✅ 完整 |
| apiKey | ✅（只读） | ✅ | ✅ 完整（使用登录的API Key） |
| avatarAppId | ✅（仅数字人） | ✅ | ✅ 完整 |
| avatarAppSecret | ✅（仅数字人） | ✅ | ✅ 完整 |

**结论：** ✅ **所有字段都已正确保存到数据库**

### 3.2 用户角色（UserRole）

**表单字段 vs 保存字段对比：**

| 字段 | 表单中有 | 保存中有 | 状态 |
|------|---------|---------|------|
| name | ✅ | ✅ | ✅ 完整 |
| type | ✅ | ✅ | ✅ 完整 |
| avatar | ✅ | ✅ | ✅ 完整 |
| positionX | ⚠️（无UI，通过拖拽） | ✅ | ✅ 完整（拖拽时保存） |
| positionY | ⚠️（无UI，通过拖拽） | ✅ | ✅ 完整（拖拽时保存） |
| scale | ✅（仅数字人） | ✅ | ✅ 完整 |
| baseURL | ✅ | ✅ | ✅ 完整 |
| model | ✅ | ✅ | ✅ 完整 |
| avatarAppId | ✅（仅数字人） | ✅ | ✅ 完整 |
| avatarAppSecret | ✅（仅数字人） | ✅ | ✅ 完整 |

**结论：** ✅ **所有字段都已正确保存到数据库**

## 四、特殊说明

### 4.1 positionX 和 positionY

- **UI中无输入框**：这两个字段在编辑面板中没有输入框
- **通过拖拽设置**：位置通过拖拽角色来设置，拖拽结束时会自动保存到数据库
- **编辑时加载**：编辑角色时，`handleEditRole` 和 `handleEditUserRole` 会正确加载这两个字段的值
- **保存时包含**：所有保存函数（创建和更新）都包含了这两个字段
- **结论**：✅ **虽然UI中无输入框，但通过拖拽设置后，保存时会正确入库**

### 4.2 baseURL（伙伴角色）

- **UI中无输入框**：伙伴角色的 baseURL 在编辑面板中没有输入框
- **后台逻辑**：创建/更新时，如果角色自己的 baseURL 为空，则使用用户角色的 baseURL
- **保存时包含**：保存函数中包含了 baseURL（通过后台逻辑计算）
- **结论**：✅ **虽然UI中无输入框，但保存时会正确入库（通过后台逻辑）**

## 五、最终结论

✅ **所有角色（含立绘）的编辑面板项的保存都已完整入库！**

- 所有UI中可见的字段都已正确保存
- 所有表单中定义的字段（包括 positionX、positionY）都已正确保存
- 位置字段通过拖拽设置，保存时会正确入库
- baseURL 字段通过后台逻辑处理，保存时会正确入库

