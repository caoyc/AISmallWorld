# XmovAvatarSDK-main 安装和启动指南

## 📋 前置要求

### 1. 环境检查

确保已安装以下软件：

- **Node.js**: >= 16.0.0
- **包管理器**: pnpm (推荐) 或 npm/yarn

#### 检查 Node.js 版本
```bash
node -v
```

如果未安装 Node.js，请访问 [Node.js 官网](https://nodejs.org/) 下载安装。

#### 安装 pnpm (推荐)
```bash
# 使用 npm 安装
npm install -g pnpm

# 或使用其他方式
# Windows (PowerShell)
iwr https://get.pnpm.io/install.ps1 -useb | iex

# macOS/Linux
curl -fsSL https://get.pnpm.io/install.sh | sh -
```

检查 pnpm 版本：
```bash
pnpm -v
```

## 🚀 安装步骤

### 1. 进入项目目录

```bash
cd XmovAvatarSDK-main
```

### 2. 安装依赖

使用 pnpm (推荐)：
```bash
pnpm install
```

或使用 npm：
```bash
npm install
```

或使用 yarn：
```bash
yarn install
```

### 3. 等待安装完成

安装过程可能需要几分钟，取决于网络速度。

## ▶️ 启动项目

### 开发环境启动

```bash
# 使用 pnpm
pnpm run dev

# 或使用 npm
npm run dev

# 或使用 yarn
yarn dev
```

启动成功后，终端会显示类似以下信息：
```
  VITE v7.1.2  ready in 500 ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

### 访问应用

在浏览器中打开显示的地址（通常是 `http://localhost:5173/`）

## 🔧 其他命令

### 构建生产版本

```bash
pnpm run build
```

构建完成后，文件会输出到 `dist` 目录。

### 预览构建结果

```bash
pnpm run preview
```

## ⚙️ 配置说明

启动应用后，需要在右侧配置面板中配置以下参数：

### 1. 虚拟人 SDK 配置

- **应用 APP ID**: 从 [魔珐星云](https://c.c1nd.cn/9C9WW) 获取
- **应用 APP Secret**: 从 [魔珐星云](https://c.c1nd.cn/9C9WW) 获取

### 2. 语音识别配置（可选）

- **ASR App ID**: 腾讯云语音识别应用ID
- **ASR Secret ID**: 腾讯云访问密钥ID
- **ASR Secret Key**: 腾讯云访问密钥

获取方式：[腾讯云ASR](https://cloud.tencent.com/product/asr?Is=sdk-topnav)

### 3. 大语言模型配置

- **模型选择**: 
  - `deepseek-chat` (默认，已预填 API Key)
  - `doubao-1-5-pro-32k-250115`
- **API Key**: 
  - DeepSeek: 默认已预填，可点击眼睛图标查看/隐藏
  - 如需使用其他模型，请填入对应的 API Key

## 🎯 使用流程

1. **配置参数**: 在右侧"配置"Tab中填入所需的API配置信息
2. **建立连接**: 点击"连接"按钮初始化虚拟人SDK
3. **开始对话**: 
   - 在"对话"Tab中输入文本消息，点击"发送"
   - 或点击"语音输入"按钮进行语音对话
4. **查看回复**: 虚拟人会播报AI回复，同时显示字幕和背景图片（如果消息中包含图片）

## 🌍 BoinicWorld 游戏世界指令系统

AISmallWorld 集成了 BoinicWorld 智能游戏世界系统，支持通过指令操作游戏世界。目前支持**正常对话模式**和**强指令模式（! 开头）**。

### 正常对话模式

**说明**：直接输入文字，与AI进行正常对话，无需任何特殊前缀。

**使用方式**：
在对话输入框中直接输入文字，然后点击"发送"按钮。系统会将消息发送到 BoinicWorld 进行处理，AI会以角色身份回复你的对话。

**特点**：

- ✅ 支持多轮对话
- ✅ 自动记忆对话内容（仿生记忆系统）
- ✅ 适合日常交流和咨询


**注意事项**：
- 正常对话会触发仿生记忆系统，AI会记住你们的对话内容
- 对话内容会被用于构建AI的人格背景和记忆
- 支持多轮连续对话，AI会基于之前的对话内容进行回复

---

### 强指令模式（! 开头）

**说明**：使用 `!` 开头，直接执行游戏指令，速度最快。

**语法**：`!指令名称 参数`

**特点**：
- ✅ 执行速度快
- ✅ 直接调用游戏指令
- ✅ 适合熟悉指令的用户

**支持的指令前缀**：
- `!`（半角感叹号）
- `！`（全角感叹号）

**使用方式**：
在对话输入框中输入以 `!` 开头的指令，然后点击"发送"按钮。系统会将指令发送到 BoinicWorld 进行处理。

**示例**：
```
!look
!create name=温馨家园 desc="一个温馨舒适的居住区域"
!visit name=温馨家园
!room create name=客厅 desc="住宅区的主要活动空间"
```

---

### 层级概念说明

游戏世界采用四层结构，每层有不同的功能和可用的指令：

#### World层（荒野层）

**概念**：最外层，代表整个游戏世界的坐标系统。

**功能**：
- 创建和管理区域（Region）
- 在世界坐标中移动

**支持的指令**：`create`、`delete`、`look`、`visit`、`goto`、`north`、`south`、`east`、`west`、`northeast`、`northwest`、`southeast`、`southwest`、`up`、`down`

**指令示例**：
```
!look                                    # 查看当前位置
!create name=温馨家园 desc="一个温馨舒适的居住区域"  # 创建区域
!visit name=温馨家园                     # 进入区域
!goto 100,200                           # 前往坐标
!north                                  # 向北走
```

---

#### Region层（区域层）

**概念**：区域层，代表一个具体的区域，包含多个场所。

**功能**：
- 创建和管理场所（Place）
- 更新区域描述和图像
- 在区域内移动

**支持的指令**：`create`、`update`、`delete`、`look`、`visit`、`return`、`goto`、`north`、`south`、`east`、`west`、`northeast`、`northwest`、`southeast`、`southwest`、`up`、`down`

**指令示例**：
```
!create name=住宅区 desc="温馨家园的主要居住区域"  # 创建场所
!update desc="温馨家园是一个温馨舒适的居住区域"    # 更新区域描述
!look                                    # 查看当前区域
!list                                    # 列出所有场所
!return                                  # 返回荒野层
!visit name=住宅区                       # 进入场所
!north                                   # 向北走
```

---

#### Place层（场所层）

**概念**：场所层，代表区域内的一个具体场所，包含多个房间。

**功能**：
- 创建和管理房间（Room）
- 创建物品、出口、NPC等对象
- 更新场所描述和图像

**支持的指令**：`create`、`update`、`delete`、`look`、`visit`、`return`、`room`、`exit`、`npc`、`item`、`monster`、`animal`、`plant`

**指令示例**：
```
!room create name=客厅 desc="住宅区的主要活动空间"  # 创建房间
!room list                                # 列出所有房间
!room look name=客厅                      # 查看房间
!item create name=沙发 desc="客厅的主要家具"  # 创建物品
!item list                                # 列出所有物品
!exit create name=卧室门 to=卧室 desc="从客厅通往卧室的门"  # 创建出口
!exit list                                # 列出所有出口
!npc create name=店小二 desc="负责接待的店小二"  # 创建NPC
!npc list                                 # 列出所有NPC
!return                                   # 返回区域层
```

---

#### Room层（房间层）

**概念**：房间层，代表场所内的一个具体房间，是最细粒度的空间单位。

**功能**：
- 创建和管理物品（item）
- 创建和管理出口（exit）
- 创建和管理NPC、怪物、动物、植物
- 物品交互（获取、丢弃等）
- 通过出口移动到其他房间

**支持的指令**：`look`、`return`、`item`、`exit`、`npc`、`monster`、`animal`、`plant`、`update`、`go`、`north`、`south`、`east`、`west`、`northeast`、`northwest`、`southeast`、`southwest`、`up`、`down`

**指令示例**：
```
!look                                    # 查看当前房间
!update desc="更新后的房间描述"            # 更新房间描述
!return                                  # 返回场所层
!item create name=沙发 desc="客厅的主要家具"  # 创建物品
!item get name=沙发                      # 拿起物品
!item drop name=沙发                    # 放下物品
!item list                               # 列出所有物品
!exit create name=卧室门 to=卧室 desc="从客厅通往卧室的门"  # 创建出口
!go name=卧室门                          # 通过出口移动
!exit list                               # 列出所有出口
!npc create name=店小二 desc="负责接待的店小二"  # 创建NPC
!npc look name=店小二                    # 查看NPC
!npc list                                # 列出所有NPC
```

---

### 层级关系图

```
World层（荒野层）
  └── Region层（区域层）
       └── Place层（场所层）
            └── Room层（房间层）
```

**层级进入**：使用 `visit` 指令进入下一层
- World层 → Region层：`!visit name=区域名`
- Region层 → Place层：`!visit name=场所名`
- Place层 → Room层：`!visit name=房间名`

**层级返回**：使用 `return` 指令返回上一层
- Room层 → Place层：`!return`
- Place层 → Region层：`!return`
- Region层 → World层：`!return`

**层级移动顺序**：
- **进入**：World → Region → Place → Room（使用 `visit` 指令）
- **返回**：Room → Place → Region → World（使用 `return` 指令）

---

### 指令参数格式

强指令模式需要严格按照指令语法格式，参数使用 `name=值` 的形式：

**正确示例**：
```
!create name=温馨家园 desc="一个温馨舒适的居住区域"
!visit name=温馨家园
!room create name=客厅 desc="住宅区的主要活动空间"
!item create name=沙发 desc="客厅的主要家具"
```

**注意事项**：
- 参数名和值之间使用 `=` 连接
- 如果值包含空格，需要用引号包裹（如 `desc="描述内容"`）
- 多个参数之间用空格分隔

---

### 快速参考

| 操作 | 强指令（!） |
|------|------------|
| 查看位置 | `!look` |
| 创建区域 | `!create name=区域名 desc="描述"` |
| 进入区域 | `!visit name=区域名` |
| 创建场所 | `!create name=场所名 desc="描述"` |
| 创建房间 | `!room create name=房间名 desc="描述"` |
| 创建物品 | `!item create name=物品名 desc="描述"` |
| 创建出口 | `!exit create name=出口名 to=目标 desc="描述"` |
| 创建NPC | `!npc create name=NPC名 desc="描述"` |
| 返回上一层 | `!return` |
| 通过出口 | `!go name=出口名` |

---

### 📚 开发示例

想要了解如何完整地构建一个游戏世界？可以参考以下示例文档：

**[晨昏雨林 - 指令转换文档](示例文档：晨昏雨林.md)**

这是一个完整的游戏世界开发示例，展示了如何从零开始构建一个完整的游戏场景：

- **完整的层级结构**：从区域层到房间层的完整构建流程
- **详细的指令示例**：包含所有创建、移动、交互指令的实际应用
- **场景描述**：展示了如何编写生动的场景描述
- **物品和出口**：完整的物品创建和出口连接示例
- **可直接执行**：所有指令都可以直接复制到对话框中执行

该示例文档包含：
- 区域层：创建"晨昏雨林"区域
- 场所层：创建"晚晴茶馆"、"青藤小筑"、"藤悬蔓廊"等场所
- 房间层：创建各个场所内的房间
- 物品层：创建各类物品和装饰
- 出口层：连接各个房间的出口

通过这个示例，你可以学习到：
1. 如何规划游戏世界的层级结构
2. 如何编写吸引人的场景描述
3. 如何创建和连接游戏对象
4. 如何组织指令的执行顺序

---

## 🧠 仿生记忆系统

AISmallWorld 集成了 BoinicWorld 的仿生记忆系统（BionicMemory），为AI提供智能记忆管理能力。

### 什么是仿生记忆系统？

仿生记忆系统是一个基于仿生学原理的AI记忆管理系统，模拟人类大脑的长短期记忆机制，让AI能够记住与你的对话内容，并在后续对话中自然地引用这些记忆。

### 核心特性

#### 1. 长短期记忆机制

- **短期记忆**：保存最近的对话内容，用于当前对话的上下文理解
- **长期记忆**：将重要信息转化为长期记忆，永久保存
- **自动转换**：系统会自动判断哪些内容需要转为长期记忆

#### 2. 智能遗忘机制

- **用进废退**：基于牛顿冷却定律的遗忘算法
- **自然遗忘**：不常用的记忆会逐渐淡化，但不会完全消失
- **重要记忆保护**：重要的个性化内容会被保护，避免丢失

#### 3. 记忆检索与激活

- **智能检索**：根据当前对话内容，自动检索相关的历史记忆
- **上下文关联**：将相关记忆激活并注入到对话上下文中
- **个性化回复**：AI会基于你的历史对话习惯和偏好进行回复

#### 4. 多租户安全隔离

- **用户隔离**：每个用户的记忆完全独立，互不干扰
- **数据安全**：所有记忆数据存储在本地，完全掌控
- **隐私保护**：严格的数据访问控制

### 工作原理

1. **对话记录**：每次对话都会被记录到记忆系统中
2. **内容分析**：系统分析对话内容的重要性和相关性
3. **记忆存储**：重要内容转为长期记忆，普通内容作为短期记忆
4. **记忆检索**：在后续对话中，系统自动检索相关记忆
5. **上下文注入**：将检索到的记忆注入到对话上下文中
6. **个性化回复**：AI基于记忆和当前对话生成个性化回复

### 使用场景

- **多轮对话**：支持连续多轮对话，AI会记住之前的内容
- **个性化交流**：AI会记住你的偏好、习惯和特点
- **上下文理解**：AI能够理解对话的上下文和历史背景
- **情感记忆**：AI会记住你们之间的情感互动和重要时刻

### 注意事项

1. **记忆持久化**：你的对话内容会被永久保存（除非手动清理）
2. **隐私保护**：所有记忆数据仅用于改善对话体验，不会泄露
3. **记忆管理**：系统会自动管理记忆，重要内容会被优先保留
4. **个性化构建**：通过长期对话，AI会逐渐构建出你的人格背景

### 技术特点

- **本地Embedding**：使用本地Qwen3-Embedding-0.6B模型，无需外部API
- **向量数据库**：基于ChromaDB的高效向量检索
- **异步处理**：记忆处理不阻塞对话响应，保证流畅体验
- **智能摘要**：自动压缩长文本内容，提高存储效率

---

## 🐛 常见问题

### 1. 端口被占用

如果 5173 端口被占用，Vite 会自动尝试其他端口。或者可以手动指定端口：

```bash
pnpm run dev -- --port 3000
```

### 2. 依赖安装失败

- 检查网络连接
- 尝试清除缓存后重新安装：
  ```bash
  # pnpm
  pnpm store prune
  pnpm install
  
  # npm
  npm cache clean --force
  npm install
  ```

### 3. SDK 加载失败

- 检查网络连接，确保可以访问 CDN
- 查看浏览器控制台的错误信息
- 确保已正确配置虚拟人 SDK 的 App ID 和 App Secret

### 4. 麦克风权限

语音输入功能需要浏览器麦克风权限，请确保：
- 浏览器已授予麦克风权限
- 使用 HTTPS 或 localhost 访问（某些浏览器要求）

## 📝 注意事项

1. **API 配置**: 确保所有 API 配置信息正确填写
2. **网络连接**: 需要稳定的网络连接以确保 SDK 和 API 正常工作
3. **浏览器兼容**: 建议使用现代浏览器（Chrome、Edge、Firefox 最新版本）
4. **麦克风权限**: 语音功能需要浏览器麦克风权限

## 🔗 相关链接

- [魔珐星云 SDK](https://c.c1nd.cn/9C9WW)
- [腾讯云 ASR](https://cloud.tencent.com/product/asr?Is=sdk-topnav)
- [DeepSeek API](https://api.deepseek.com)
- [Vite 文档](https://vitejs.dev/)

